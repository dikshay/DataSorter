package fileupload;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.HashMap;
import java.util.Vector;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.Part;

import com.dikshay.clasificacion.Utilities.Constants;

import interfaces.CommandInterface;

public class ReadFileData implements CommandInterface{
	private static ReadFileData readFileData;
	Vector<Integer> fileData = new Vector<Integer>();
	public static ReadFileData getInstance()
	{
		if(readFileData == null)
		{
			readFileData = new ReadFileData();
		}
		return readFileData;
	}
	@Override
	public boolean execute(HashMap<String, String> pRequestParameters, HashMap<String, Object> pRequestStorage,
			HashMap<String, Object> pResponseStorage) throws Exception {
		// TODO Auto-generated method stub
		HttpServletRequest pRequest = (HttpServletRequest) pRequestStorage.get(Constants.SERVLET_REQUEST_COMMAND);
		 String description = pRequest.getParameter("description"); // Retrieves <input type="text" name="description">
		    Part filePart;
			try {
				filePart = pRequest.getPart("file");
			
		    String fileName = filePart.getSubmittedFileName();
		    InputStream fileContent = filePart.getInputStream();
		    BufferedReader reader = new BufferedReader(new InputStreamReader(fileContent));
	        StringBuilder out = new StringBuilder();
	        String line;
	        while ((line = reader.readLine()) != null) {
	            out.append(line);
	            fileData.add(Integer.parseInt(line));
	        }
	        System.out.println(out.toString()); 
			} catch (IOException | ServletException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			} // Retrieves <input type="file" name="file">
			
		return false;
	}
}
